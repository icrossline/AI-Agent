<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Automation Agent</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=IBM+Plex+Mono:wght@300;400;500&family=IBM+Plex+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --void: #050508;
  --deep: #080b12;
  --surface: #0d1220;
  --raised: #111827;
  --border: #1a2640;
  --border-glow: #1e3a5f;
  --cyan: #00d4ff;
  --cyan-dim: rgba(0,212,255,0.15);
  --cyan-glow: rgba(0,212,255,0.4);
  --green: #00ff88;
  --green-dim: rgba(0,255,136,0.12);
  --amber: #ffaa00;
  --amber-dim: rgba(255,170,0,0.12);
  --red: #ff4466;
  --red-dim: rgba(255,68,102,0.12);
  --blue: #4488ff;
  --blue-dim: rgba(68,136,255,0.12);
  --text: #8ba3c4;
  --text-bright: #cce0ff;
  --text-dim: #3a5070;
  --text-muted: #243040;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html, body { height: 100%; overflow: hidden; }

body {
  background: var(--void);
  color: var(--text);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 13px;
  position: relative;
}

/* Star field background */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    radial-gradient(1px 1px at 10% 15%, rgba(0,212,255,0.6) 0%, transparent 100%),
    radial-gradient(1px 1px at 25% 40%, rgba(255,255,255,0.3) 0%, transparent 100%),
    radial-gradient(1px 1px at 45% 10%, rgba(0,212,255,0.4) 0%, transparent 100%),
    radial-gradient(1px 1px at 60% 60%, rgba(255,255,255,0.2) 0%, transparent 100%),
    radial-gradient(1px 1px at 75% 25%, rgba(0,255,136,0.4) 0%, transparent 100%),
    radial-gradient(1px 1px at 85% 75%, rgba(255,255,255,0.3) 0%, transparent 100%),
    radial-gradient(1px 1px at 90% 45%, rgba(0,212,255,0.5) 0%, transparent 100%),
    radial-gradient(2px 2px at 35% 80%, rgba(0,212,255,0.3) 0%, transparent 100%),
    radial-gradient(1px 1px at 55% 90%, rgba(255,255,255,0.2) 0%, transparent 100%),
    radial-gradient(1px 1px at 15% 65%, rgba(68,136,255,0.4) 0%, transparent 100%);
  pointer-events: none;
  z-index: 0;
}

/* Subtle grid overlay */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(rgba(0,212,255,0.015) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,212,255,0.015) 1px, transparent 1px);
  background-size: 40px 40px;
  pointer-events: none;
  z-index: 0;
}

/* ===== LAYOUT ===== */
#app {
  display: grid;
  grid-template-rows: 56px 1fr;
  grid-template-columns: 240px 1fr 280px;
  height: 100vh;
  position: relative;
  z-index: 1;
}

/* ===== TOPBAR ===== */
#topbar {
  grid-column: 1 / -1;
  background: rgba(8,11,18,0.95);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
}

#topbar::after {
  content: '';
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--cyan), transparent);
  opacity: 0.5;
}

.brand {
  display: flex;
  align-items: center;
  gap: 12px;
}

.brand-icon {
  width: 34px; height: 34px;
  border: 1px solid var(--cyan);
  border-radius: 6px;
  display: grid;
  place-items: center;
  position: relative;
  overflow: hidden;
}

.brand-icon::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at center, var(--cyan-dim), transparent);
  animation: icon-pulse 3s ease-in-out infinite;
}

@keyframes icon-pulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}

.brand-icon svg { position: relative; z-index: 1; }

.brand-name {
  font-family: 'Orbitron', sans-serif;
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 0.1em;
  color: var(--text-bright);
}

.brand-name span { color: var(--cyan); }

.topbar-center {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  color: var(--text-dim);
  font-family: 'IBM Plex Mono', monospace;
}

.status-pill {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 3px 10px;
  border-radius: 20px;
  border: 1px solid;
  font-size: 10px;
  letter-spacing: 0.08em;
}

.status-pill.online {
  border-color: rgba(0,255,136,0.3);
  background: var(--green-dim);
  color: var(--green);
}

.status-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--green);
  box-shadow: 0 0 6px var(--green);
  animation: status-blink 2s ease-in-out infinite;
}

@keyframes status-blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

.topbar-right {
  display: flex;
  align-items: center;
  gap: 16px;
  font-size: 11px;
  color: var(--text-dim);
}

.model-badge {
  padding: 3px 10px;
  border: 1px solid var(--border-glow);
  border-radius: 4px;
  color: var(--cyan);
  font-size: 10px;
  letter-spacing: 0.06em;
}

#task-count { color: var(--text-dim); }

/* ===== LEFT SIDEBAR ===== */
#sidebar {
  background: var(--deep);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.sidebar-block {
  padding: 14px;
  border-bottom: 1px solid var(--border);
}

.sidebar-label {
  font-size: 9px;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.sidebar-label::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border);
}

/* Task type buttons */
.type-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 5px;
}

.type-btn {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 9px 6px;
  cursor: pointer;
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  color: var(--text-dim);
  transition: all 0.2s;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;
}

.type-btn .t-icon { font-size: 16px; }

.type-btn:hover {
  border-color: var(--cyan);
  color: var(--cyan);
  background: var(--cyan-dim);
  box-shadow: 0 0 12px rgba(0,212,255,0.1);
}

/* Quick prompts */
.quick-list {
  display: flex;
  flex-direction: column;
  gap: 3px;
}

.quick-item {
  padding: 7px 10px;
  font-size: 10px;
  color: var(--text-dim);
  border-left: 2px solid var(--border);
  cursor: pointer;
  transition: all 0.2s;
  border-radius: 0 4px 4px 0;
  line-height: 1.4;
}

.quick-item:hover {
  border-left-color: var(--cyan);
  color: var(--text);
  background: var(--cyan-dim);
  padding-left: 14px;
}

/* History */
.history-scroll {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
}

.history-scroll::-webkit-scrollbar { width: 3px; }
.history-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

.history-entry {
  display: flex;
  gap: 7px;
  padding: 7px 8px;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.2s;
  border: 1px solid transparent;
  margin-bottom: 3px;
  align-items: flex-start;
}

.history-entry:hover {
  background: var(--surface);
  border-color: var(--border);
}

.history-type-tag {
  font-size: 9px;
  padding: 1px 5px;
  border-radius: 3px;
  background: var(--raised);
  color: var(--cyan);
  white-space: nowrap;
  flex-shrink: 0;
  margin-top: 1px;
  border: 1px solid var(--border-glow);
}

.history-text {
  font-size: 10px;
  color: var(--text-dim);
  line-height: 1.4;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.no-history {
  text-align: center;
  font-size: 10px;
  color: var(--text-muted);
  padding: 16px;
  font-style: italic;
}

/* ===== MAIN AREA ===== */
#main {
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: var(--void);
  position: relative;
}

/* Radial glow behind chat */
#main::before {
  content: '';
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 500px;
  height: 400px;
  background: radial-gradient(ellipse, rgba(0,212,255,0.03) 0%, transparent 70%);
  pointer-events: none;
}

#chat-window {
  flex: 1;
  overflow-y: auto;
  padding: 20px 24px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  scroll-behavior: smooth;
  position: relative;
  z-index: 1;
}

#chat-window::-webkit-scrollbar { width: 4px; }
#chat-window::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* Welcome screen */
#welcome {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100%;
  gap: 16px;
  padding: 32px;
}

.welcome-ring {
  width: 80px; height: 80px;
  border-radius: 50%;
  border: 1px solid var(--border-glow);
  display: grid;
  place-items: center;
  position: relative;
  animation: ring-rotate 8s linear infinite;
}

.welcome-ring::before {
  content: '';
  position: absolute;
  inset: -4px;
  border-radius: 50%;
  border: 1px solid transparent;
  border-top-color: var(--cyan);
  animation: ring-rotate 3s linear infinite;
}

@keyframes ring-rotate {
  to { transform: rotate(360deg); }
}

.welcome-ring-inner {
  width: 56px; height: 56px;
  border-radius: 50%;
  background: radial-gradient(circle, var(--cyan-dim), transparent);
  border: 1px solid rgba(0,212,255,0.3);
  display: grid;
  place-items: center;
  font-size: 24px;
  animation: ring-rotate 8s linear infinite reverse;
}

.welcome-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 18px;
  font-weight: 700;
  color: var(--text-bright);
  letter-spacing: 0.1em;
  text-align: center;
}

.welcome-sub {
  font-size: 11px;
  color: var(--text-dim);
  text-align: center;
  max-width: 380px;
  line-height: 1.7;
}

.welcome-tags {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  justify-content: center;
}

.welcome-tag {
  padding: 4px 10px;
  border: 1px solid var(--border-glow);
  border-radius: 20px;
  font-size: 10px;
  color: var(--cyan);
  background: var(--cyan-dim);
}

/* Messages */
.msg {
  display: flex;
  gap: 10px;
  animation: msg-in 0.3s ease;
  align-items: flex-start;
}

@keyframes msg-in {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

.msg.user { flex-direction: row-reverse; }

.msg-avatar {
  width: 30px; height: 30px;
  border-radius: 6px;
  display: grid;
  place-items: center;
  font-size: 13px;
  flex-shrink: 0;
  border: 1px solid var(--border);
}

.msg-avatar.agent-av {
  background: linear-gradient(135deg, rgba(0,212,255,0.15), rgba(0,255,136,0.1));
  border-color: rgba(0,212,255,0.4);
}

.msg-avatar.user-av {
  background: rgba(68,136,255,0.12);
  border-color: rgba(68,136,255,0.3);
}

.msg-body { max-width: 72%; }

.msg-meta {
  font-size: 9px;
  color: var(--text-dim);
  margin-bottom: 5px;
  display: flex;
  align-items: center;
  gap: 6px;
  letter-spacing: 0.06em;
}

.msg.user .msg-meta { flex-direction: row-reverse; }

.type-tag {
  font-size: 9px;
  padding: 1px 6px;
  border-radius: 3px;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  border: 1px solid;
}

.type-tag.schedule    { color: var(--green);  border-color: rgba(0,255,136,0.3);   background: var(--green-dim); }
.type-tag.analysis    { color: var(--cyan);   border-color: rgba(0,212,255,0.3);   background: var(--cyan-dim); }
.type-tag.search      { color: var(--amber);  border-color: rgba(255,170,0,0.3);   background: var(--amber-dim); }
.type-tag.calculation { color: var(--red);    border-color: rgba(255,68,102,0.3);  background: var(--red-dim); }
.type-tag.organization { color: var(--blue);  border-color: rgba(68,136,255,0.3);  background: var(--blue-dim); }
.type-tag.textProcessing { color: #cc88ff;   border-color: rgba(204,136,255,0.3); background: rgba(204,136,255,0.1); }
.type-tag.other, .type-tag.generic { color: var(--text-dim); border-color: var(--border); background: var(--surface); }

.bubble {
  border-radius: 10px;
  padding: 12px 15px;
  font-size: 12px;
  line-height: 1.6;
  border: 1px solid;
}

.bubble.agent {
  background: var(--surface);
  border-color: var(--border-glow);
  border-top-left-radius: 2px;
  color: var(--text);
}

.bubble.user {
  background: rgba(68,136,255,0.1);
  border-color: rgba(68,136,255,0.25);
  border-top-right-radius: 2px;
  color: var(--text-bright);
}

.bubble-summary {
  color: var(--text-bright);
  margin-bottom: 10px;
  font-size: 12px;
}

/* Result cards */
.result-card {
  margin-top: 8px;
  border: 1px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
  background: var(--deep);
}

.result-card-header {
  padding: 7px 12px;
  background: rgba(0,212,255,0.05);
  border-bottom: 1px solid var(--border);
  font-size: 9px;
  color: var(--cyan);
  letter-spacing: 0.12em;
  text-transform: uppercase;
  display: flex;
  align-items: center;
  gap: 6px;
}

.result-card-header::before {
  content: '';
  width: 5px; height: 5px;
  border-radius: 50%;
  background: var(--cyan);
  box-shadow: 0 0 6px var(--cyan);
}

.result-card-body {
  padding: 12px;
}

.r-row {
  display: flex;
  gap: 10px;
  padding: 5px 0;
  border-bottom: 1px solid rgba(26,38,64,0.6);
  font-size: 11px;
  align-items: flex-start;
}

.r-row:last-child { border-bottom: none; }

.r-key {
  color: var(--text-dim);
  min-width: 72px;
  flex-shrink: 0;
  font-size: 10px;
}

.r-val { color: var(--text-bright); flex: 1; }

.insight-item {
  display: flex;
  gap: 8px;
  padding: 5px 0;
  font-size: 11px;
  color: var(--text);
  border-bottom: 1px dashed rgba(26,38,64,0.6);
  align-items: flex-start;
}

.insight-item:last-child { border-bottom: none; }

.insight-item::before {
  content: '‚ñ∏';
  color: var(--cyan);
  flex-shrink: 0;
  margin-top: 1px;
}

.calc-result {
  font-family: 'Orbitron', sans-serif;
  font-size: 22px;
  font-weight: 700;
  color: var(--cyan);
  text-shadow: 0 0 20px var(--cyan-glow);
  padding: 12px 0 8px;
}

.search-result-item {
  padding: 8px 0;
  border-bottom: 1px solid rgba(26,38,64,0.6);
}

.search-result-item:last-child { border-bottom: none; }

.search-result-title {
  font-size: 11px;
  color: var(--cyan);
  display: flex;
  justify-content: space-between;
  margin-bottom: 3px;
}

.search-relevance {
  color: var(--amber);
  font-size: 10px;
}

.search-result-summary {
  font-size: 10px;
  color: var(--text-dim);
  line-height: 1.4;
}

/* Steps */
.steps-track {
  margin-top: 10px;
  padding-top: 8px;
  border-top: 1px solid var(--border);
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.step-pill {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 9px;
  color: var(--green);
  background: var(--green-dim);
  border: 1px solid rgba(0,255,136,0.2);
  padding: 3px 8px;
  border-radius: 20px;
}

.step-pill::before {
  content: '‚úì';
  font-size: 8px;
}

/* Typing indicator */
.typing-msg {
  display: flex;
  gap: 10px;
  align-items: flex-start;
  animation: msg-in 0.3s ease;
}

.typing-bubble {
  background: var(--surface);
  border: 1px solid var(--border-glow);
  border-radius: 10px;
  border-top-left-radius: 2px;
  padding: 12px 16px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.typing-dots {
  display: flex;
  gap: 5px;
  align-items: center;
}

.t-dot {
  width: 7px; height: 7px;
  border-radius: 50%;
  animation: t-bounce 1.2s ease-in-out infinite;
}

.t-dot:nth-child(1) { background: var(--cyan); animation-delay: 0s; }
.t-dot:nth-child(2) { background: var(--green); animation-delay: 0.2s; }
.t-dot:nth-child(3) { background: var(--blue); animation-delay: 0.4s; }

@keyframes t-bounce {
  0%, 100% { transform: translateY(0); opacity: 0.4; }
  50% { transform: translateY(-5px); opacity: 1; }
}

.typing-status {
  font-size: 10px;
  color: var(--text-dim);
  animation: fade-pulse 1.5s ease-in-out infinite;
  letter-spacing: 0.06em;
}

@keyframes fade-pulse {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 0.9; }
}

/* ===== INPUT AREA ===== */
#input-zone {
  padding: 14px 24px 18px;
  border-top: 1px solid var(--border);
  background: rgba(8,11,18,0.9);
  backdrop-filter: blur(8px);
  position: relative;
  z-index: 2;
}

#input-zone::before {
  content: '';
  position: absolute;
  top: 0; left: 10%; right: 10%;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--cyan), transparent);
  opacity: 0.3;
}

.input-row {
  display: flex;
  gap: 10px;
  align-items: flex-end;
  background: var(--surface);
  border: 1px solid var(--border-glow);
  border-radius: 10px;
  padding: 10px 14px;
  transition: all 0.2s;
}

.input-row:focus-within {
  border-color: var(--cyan);
  box-shadow: 0 0 0 2px rgba(0,212,255,0.08), 0 0 20px rgba(0,212,255,0.05);
}

.input-prompt {
  color: var(--cyan);
  font-size: 15px;
  padding-bottom: 2px;
  flex-shrink: 0;
  opacity: 0.8;
}

#msg-input {
  flex: 1;
  background: none;
  border: none;
  outline: none;
  color: var(--text-bright);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 12px;
  resize: none;
  min-height: 22px;
  max-height: 110px;
  line-height: 1.5;
}

#msg-input::placeholder { color: var(--text-muted); }

#send-btn {
  background: linear-gradient(135deg, var(--cyan), #0088aa);
  border: none;
  border-radius: 7px;
  width: 34px; height: 34px;
  cursor: pointer;
  display: grid;
  place-items: center;
  transition: all 0.2s;
  flex-shrink: 0;
  color: var(--void);
  font-size: 14px;
}

#send-btn:hover:not(:disabled) {
  transform: scale(1.05);
  box-shadow: 0 0 16px var(--cyan-glow);
}

#send-btn:active { transform: scale(0.96); }
#send-btn:disabled { opacity: 0.35; cursor: not-allowed; }

.input-hints {
  display: flex;
  justify-content: space-between;
  margin-top: 6px;
  font-size: 9px;
  color: var(--text-muted);
  letter-spacing: 0.04em;
}

.input-hints kbd {
  background: var(--raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 1px 4px;
  font-family: 'IBM Plex Mono', monospace;
  font-size: 8px;
  color: var(--text-dim);
}

/* ===== RIGHT PANEL ===== */
#right-panel {
  border-left: 1px solid var(--border);
  background: var(--deep);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.panel-nav {
  display: flex;
  border-bottom: 1px solid var(--border);
}

.panel-nav-btn {
  flex: 1;
  padding: 11px 6px;
  font-size: 9px;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: var(--text-dim);
  cursor: pointer;
  border: none;
  background: none;
  font-family: 'IBM Plex Mono', monospace;
  transition: all 0.2s;
  border-bottom: 2px solid transparent;
  margin-bottom: -1px;
}

.panel-nav-btn.active {
  color: var(--cyan);
  border-bottom-color: var(--cyan);
  background: var(--cyan-dim);
}

.panel-body {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
}

.panel-body::-webkit-scrollbar { width: 3px; }
.panel-body::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* Log entries */
.log-line {
  display: grid;
  grid-template-columns: 60px 1fr;
  gap: 6px;
  padding: 4px 0;
  font-size: 10px;
  border-bottom: 1px solid rgba(26,38,64,0.3);
  animation: fade-in 0.3s ease;
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

.log-ts { color: var(--text-muted); font-size: 9px; }
.log-txt.info    { color: var(--cyan); }
.log-txt.success { color: var(--green); }
.log-txt.warning { color: var(--amber); }
.log-txt.error   { color: var(--red); }

.no-logs {
  text-align: center;
  font-size: 10px;
  color: var(--text-muted);
  padding: 20px 10px;
  font-style: italic;
  line-height: 1.6;
}

/* Stats panel */
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
  margin-bottom: 14px;
}

.stat-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px 10px;
  text-align: center;
}

.stat-number {
  font-family: 'Orbitron', sans-serif;
  font-size: 20px;
  font-weight: 700;
  color: var(--cyan);
  line-height: 1;
  text-shadow: 0 0 12px var(--cyan-glow);
}

.stat-label {
  font-size: 8px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.12em;
  margin-top: 5px;
}

.panel-section-label {
  font-size: 9px;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.panel-section-label::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border);
}

.breakdown-item {
  display: flex;
  align-items: center;
  gap: 7px;
  margin-bottom: 6px;
  font-size: 10px;
}

.bd-label { color: var(--text-dim); flex: 1; }

.bd-bar {
  width: 70px;
  height: 3px;
  background: var(--border);
  border-radius: 2px;
  overflow: hidden;
}

.bd-fill {
  height: 100%;
  border-radius: 2px;
  background: linear-gradient(90deg, var(--cyan), var(--green));
  transition: width 0.8s ease;
}

.bd-count { color: var(--text); min-width: 16px; text-align: right; }

.no-stats {
  text-align: center;
  font-size: 10px;
  color: var(--text-muted);
  padding: 16px 8px;
  font-style: italic;
}

/* Priority badge */
.priority-badge {
  font-size: 9px;
  padding: 1px 6px;
  border-radius: 3px;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}
.priority-badge.high   { color: var(--red);   background: var(--red-dim);   border: 1px solid rgba(255,68,102,0.2); }
.priority-badge.medium { color: var(--amber); background: var(--amber-dim); border: 1px solid rgba(255,170,0,0.2); }
.priority-badge.low    { color: var(--green); background: var(--green-dim); border: 1px solid rgba(0,255,136,0.2); }

</style>
</head>
<body>
<div id="app">

  <!-- TOP BAR -->
  <div id="topbar">
    <div class="brand">
      <div class="brand-icon">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
          <circle cx="9" cy="9" r="7" stroke="#00d4ff" stroke-width="1"/>
          <circle cx="9" cy="9" r="3" fill="#00d4ff" opacity="0.6"/>
          <line x1="9" y1="2" x2="9" y2="5" stroke="#00d4ff" stroke-width="1"/>
          <line x1="9" y1="13" x2="9" y2="16" stroke="#00d4ff" stroke-width="1"/>
          <line x1="2" y1="9" x2="5" y2="9" stroke="#00d4ff" stroke-width="1"/>
          <line x1="13" y1="9" x2="16" y2="9" stroke="#00d4ff" stroke-width="1"/>
        </svg>
      </div>
      <div class="brand-name">AI <span>AUTOMATION</span> AGENT</div>
    </div>
    <div class="topbar-center">
      <div class="status-pill online">
        <div class="status-dot"></div>
        GEMINI ONLINE
      </div>
    </div>
    <div class="topbar-right">
      <div class="model-badge">GEMINI 2.5 FLASH</div>
      <span id="task-count">0 tasks</span>
    </div>
  </div>

  <!-- LEFT SIDEBAR -->
  <div id="sidebar">
    <div class="sidebar-block">
      <div class="sidebar-label">Task Types</div>
      <div class="type-grid">
        <div class="type-btn" onclick="injectPrompt('Schedule a team meeting tomorrow at 3 PM for project review')">
          <span class="t-icon">üìÖ</span>schedule
        </div>
        <div class="type-btn" onclick="injectPrompt('Analyze sales data: Q1 revenue 45k, Q2 revenue 62k, Q3 revenue 58k')">
          <span class="t-icon">üìä</span>analysis
        </div>
        <div class="type-btn" onclick="injectPrompt('Organize my project files by type and priority level')">
          <span class="t-icon">üìÅ</span>organize
        </div>
        <div class="type-btn" onclick="injectPrompt('Search for best practices in agile project management')">
          <span class="t-icon">üîç</span>search
        </div>
        <div class="type-btn" onclick="injectPrompt('Calculate compound interest on 10000 at 7% for 5 years')">
          <span class="t-icon">üî¢</span>calculate
        </div>
        <div class="type-btn" onclick="injectPrompt('Summarize and rewrite this text to sound more professional: Our product is good and helps users do things better in their daily work.')">
          <span class="t-icon">üìù</span>text
        </div>
      </div>
    </div>

    <div class="sidebar-block">
      <div class="sidebar-label">Quick Prompts</div>
      <div class="quick-list">
        <div class="quick-item" onclick="injectPrompt('Schedule a team meeting tomorrow at 2 PM')">Schedule a meeting</div>
        <div class="quick-item" onclick="injectPrompt('Analyze monthly sales: Jan 12k, Feb 18k, Mar 15k, Apr 22k, May 19k')">Analyze sales trends</div>
        <div class="quick-item" onclick="injectPrompt('Calculate ROI: investment 50000, return 75000 over 2 years')">Calculate ROI</div>
        <div class="quick-item" onclick="injectPrompt('Search for recent AI automation tools and frameworks')">Search AI tools</div>
        <div class="quick-item" onclick="injectPrompt('Organize: report.pdf, budget.xlsx, logo.png, code.py, notes.txt, design.fig')">Organize files</div>
      </div>
    </div>

    <div class="sidebar-label" style="padding: 10px 14px 4px; margin-bottom: 0;">History</div>
    <div class="history-scroll" id="history-list">
      <div class="no-history" id="no-history">No tasks yet...</div>
    </div>
  </div>

  <!-- MAIN CHAT -->
  <div id="main">
    <div id="chat-window">
      <div id="welcome">
        <div class="welcome-ring">
          <div class="welcome-ring-inner">‚ö°</div>
        </div>
        <div class="welcome-title">MISSION CONTROL</div>
        <div class="welcome-sub">
          Powered by Gemini 2.5 Flash. Automate scheduling, data analysis, file organization, search, calculations, and text processing.
        </div>
        <div class="welcome-tags">
          <span class="welcome-tag">schedule</span>
          <span class="welcome-tag">analysis</span>
          <span class="welcome-tag">organize</span>
          <span class="welcome-tag">search</span>
          <span class="welcome-tag">calculate</span>
          <span class="welcome-tag">text</span>
        </div>
      </div>
    </div>

    <div id="input-zone">
      <div class="input-row">
        <span class="input-prompt">‚Ä∫</span>
        <textarea id="msg-input" rows="1" placeholder="Describe a task to automate..."></textarea>
        <button id="send-btn" onclick="handleSend()">‚û§</button>
      </div>
      <div class="input-hints">
        <span><kbd>Enter</kbd> send ¬∑ <kbd>Shift+Enter</kbd> new line</span>
        <span id="char-count">0 chars</span>
      </div>
    </div>
  </div>

  <!-- RIGHT PANEL -->
  <div id="right-panel">
    <div class="panel-nav">
      <button class="panel-nav-btn active" onclick="switchPanel('logs', this)">Logs</button>
      <button class="panel-nav-btn" onclick="switchPanel('stats', this)">Stats</button>
    </div>

    <div class="panel-body" id="logs-panel">
      <div class="no-logs" id="no-logs">Execution logs<br>will appear here...</div>
    </div>

    <div class="panel-body" id="stats-panel" style="display:none">
      <div class="stats-grid">
        <div class="stat-box">
          <div class="stat-number" id="s-total">0</div>
          <div class="stat-label">Total Tasks</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="s-success">‚Äì</div>
          <div class="stat-label">Success Rate</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="s-avgtime">‚Äì</div>
          <div class="stat-label">Avg Time (s)</div>
        </div>
        <div class="stat-box">
          <div class="stat-number" id="s-session">0</div>
          <div class="stat-label">This Session</div>
        </div>
      </div>
      <div class="panel-section-label">Task Breakdown</div>
      <div id="breakdown-list">
        <div class="no-stats">Run tasks to see breakdown...</div>
      </div>
    </div>
  </div>

</div>

<script>
// ============ STATE ============
const S = {
  busy: false,
  history: [],
  logs: [],
  stats: { total: 0, ok: 0, times: [], byType: {} }
};

// ============ INIT ============
window.addEventListener('DOMContentLoaded', () => {
  const inp = document.getElementById('msg-input');
  inp.addEventListener('input', () => {
    inp.style.height = 'auto';
    inp.style.height = Math.min(inp.scrollHeight, 110) + 'px';
    document.getElementById('char-count').textContent = inp.value.length + ' chars';
  });
  inp.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); }
  });
  loadHistory();
});

// ============ HISTORY (via Flask) ============
async function loadHistory() {
  try {
    const r = await fetch('/api/history');
    const d = await r.json();
    if (d.history && d.history.length) {
      S.history = d.history;
      d.history.slice(-10).reverse().forEach(t => renderHistoryEntry(t.request, t.type));
    }
  } catch (_) {}
}

async function persistHistory() {
  try {
    await fetch('/api/history', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ history: S.history })
    });
  } catch (_) {}
}

// ============ UI HELPERS ============
function injectPrompt(text) {
  const inp = document.getElementById('msg-input');
  inp.value = text;
  inp.style.height = 'auto';
  inp.style.height = Math.min(inp.scrollHeight, 110) + 'px';
  document.getElementById('char-count').textContent = text.length + ' chars';
  inp.focus();
}

function switchPanel(name, btn) {
  document.querySelectorAll('.panel-nav-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('logs-panel').style.display = name === 'logs' ? 'block' : 'none';
  document.getElementById('stats-panel').style.display = name === 'stats' ? 'block' : 'none';
}

function esc(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function now() {
  return new Date().toLocaleTimeString('en', { hour12: false });
}

// ============ LOGGING ============
function addLog(msg, type = 'info') {
  const panel = document.getElementById('logs-panel');
  const noLogs = document.getElementById('no-logs');
  if (noLogs) noLogs.remove();

  const el = document.createElement('div');
  el.className = 'log-line';
  el.innerHTML = `<span class="log-ts">${now()}</span><span class="log-txt ${type}">${esc(msg)}</span>`;
  panel.appendChild(el);
  panel.scrollTop = panel.scrollHeight;
}

// ============ CHAT RENDERING ============
function removeWelcome() {
  const w = document.getElementById('welcome');
  if (w) w.remove();
}

function addUserBubble(text) {
  removeWelcome();
  const cw = document.getElementById('chat-window');
  const el = document.createElement('div');
  el.className = 'msg user';
  el.innerHTML = `
    <div class="msg-avatar user-av">üë§</div>
    <div class="msg-body">
      <div class="msg-meta"><span>${now()}</span></div>
      <div class="bubble user">${esc(text)}</div>
    </div>`;
  cw.appendChild(el);
  cw.scrollTop = cw.scrollHeight;
}

function addTyping() {
  const cw = document.getElementById('chat-window');
  const el = document.createElement('div');
  el.className = 'typing-msg';
  el.id = 'typing';
  el.innerHTML = `
    <div class="msg-avatar agent-av">ü§ñ</div>
    <div class="typing-bubble">
      <div class="typing-dots"><div class="t-dot"></div><div class="t-dot"></div><div class="t-dot"></div></div>
      <div class="typing-status" id="typing-status">Connecting to Gemini...</div>
    </div>`;
  cw.appendChild(el);
  cw.scrollTop = cw.scrollHeight;
}

function setTypingStatus(msg) {
  const el = document.getElementById('typing-status');
  if (el) el.textContent = msg;
}

function removeTyping() {
  const el = document.getElementById('typing');
  if (el) el.remove();
}

function addAgentBubble(result, analysis) {
  const cw = document.getElementById('chat-window');
  const el = document.createElement('div');
  el.className = 'msg';
  const type = result.type || 'other';
  const data = result.data || {};
  const priority = analysis?.priority || 'medium';

  // Build result card HTML
  let cardHtml = buildResultCard(type, data);

  // Steps
  let stepsHtml = '';
  if (analysis?.steps?.length) {
    const pills = analysis.steps.map(s => `<div class="step-pill">${esc(s)}</div>`).join('');
    stepsHtml = `<div class="steps-track">${pills}</div>`;
  }

  el.innerHTML = `
    <div class="msg-avatar agent-av">ü§ñ</div>
    <div class="msg-body">
      <div class="msg-meta">
        <span>AGENT ¬∑ ${now()}</span>
        <span class="type-tag ${type}">${type.toUpperCase()}</span>
        <span class="priority-badge ${priority}">${priority}</span>
      </div>
      <div class="bubble agent">
        ${result.summary ? `<div class="bubble-summary">${esc(result.summary)}</div>` : ''}
        ${cardHtml}
        ${stepsHtml}
      </div>
    </div>`;
  cw.appendChild(el);
  cw.scrollTop = cw.scrollHeight;
}

function buildResultCard(type, data) {
  if (type === 'schedule' && data.title) {
    return `<div class="result-card">
      <div class="result-card-header">SCHEDULED EVENT</div>
      <div class="result-card-body">
        <div class="r-row"><span class="r-key">Event</span><span class="r-val">${esc(data.title)}</span></div>
        <div class="r-row"><span class="r-key">Date/Time</span><span class="r-val">${esc(data.datetime||'‚Äî')}</span></div>
        <div class="r-row"><span class="r-key">Duration</span><span class="r-val">${esc(data.duration||'‚Äî')}</span></div>
        ${data.notes ? `<div class="r-row"><span class="r-key">Notes</span><span class="r-val">${esc(data.notes)}</span></div>` : ''}
      </div>
    </div>`;
  }

  if (type === 'analysis' && data.insights) {
    const insights = data.insights.map(i => `<div class="insight-item">${esc(i)}</div>`).join('');
    const metrics = data.metrics
      ? Object.entries(data.metrics).map(([k,v]) => `<div class="r-row"><span class="r-key">${esc(k)}</span><span class="r-val">${esc(String(v))}</span></div>`).join('')
      : '';
    return `<div class="result-card">
      <div class="result-card-header">ANALYSIS RESULTS</div>
      <div class="result-card-body">
        <div style="font-size:9px;color:var(--text-dim);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:6px;">Key Insights</div>
        ${insights}
        ${metrics ? `<div style="font-size:9px;color:var(--text-dim);letter-spacing:0.12em;text-transform:uppercase;margin:8px 0 4px;">Metrics</div>${metrics}` : ''}
      </div>
    </div>`;
  }

  if (type === 'organization' && data.categories) {
    const cats = data.categories.map((c,i) => `<div class="r-row"><span class="r-key">Cat ${i+1}</span><span class="r-val">${esc(c)}</span></div>`).join('');
    return `<div class="result-card">
      <div class="result-card-header">FILE ORGANIZATION</div>
      <div class="result-card-body">${cats}</div>
    </div>`;
  }

  if (type === 'search' && data.results) {
    const results = data.results.map(r => `
      <div class="search-result-item">
        <div class="search-result-title">
          <span>${esc(r.title)}</span>
          <span class="search-relevance">${esc(r.relevance)}</span>
        </div>
        <div class="search-result-summary">${esc(r.summary)}</div>
      </div>`).join('');
    return `<div class="result-card">
      <div class="result-card-header">SEARCH RESULTS ¬∑ ${data.totalFound || data.results.length} found</div>
      <div class="result-card-body">${results}</div>
    </div>`;
  }

  if (type === 'calculation' && data.result !== undefined) {
    const steps = data.steps
      ? data.steps.map((s,i) => `<div class="r-row"><span class="r-key">Step ${i+1}</span><span class="r-val">${esc(s)}</span></div>`).join('')
      : '';
    return `<div class="result-card">
      <div class="result-card-header">CALCULATION</div>
      <div class="result-card-body">
        <div class="calc-result">${esc(String(data.result))}</div>
        ${steps}
        ${data.explanation ? `<div class="r-row"><span class="r-key">Explanation</span><span class="r-val">${esc(data.explanation)}</span></div>` : ''}
      </div>
    </div>`;
  }

  if (type === 'textProcessing' && data.processed) {
    return `<div class="result-card">
      <div class="result-card-header">TEXT PROCESSED ¬∑ ${data.wordCount||0} words</div>
      <div class="result-card-body" style="white-space:pre-wrap;font-size:11px;color:var(--text);">${esc(data.processed)}</div>
    </div>`;
  }

  if (data.response) {
    return `<div class="result-card">
      <div class="result-card-header">RESPONSE</div>
      <div class="result-card-body" style="white-space:pre-wrap;font-size:11px;color:var(--text);line-height:1.6;">${esc(data.response)}</div>
    </div>`;
  }

  return '';
}

function addErrorBubble(msg) {
  const cw = document.getElementById('chat-window');
  const el = document.createElement('div');
  el.className = 'msg';
  el.innerHTML = `
    <div class="msg-avatar agent-av">ü§ñ</div>
    <div class="msg-body">
      <div class="bubble agent" style="border-color:rgba(255,68,102,0.3);">
        <span style="color:var(--red);">‚ùå ${esc(msg)}</span>
      </div>
    </div>`;
  cw.appendChild(el);
  cw.scrollTop = cw.scrollHeight;
}

// ============ HISTORY PANEL ============
function renderHistoryEntry(request, type) {
  const list = document.getElementById('history-list');
  const noH = document.getElementById('no-history');
  if (noH) noH.remove();

  const el = document.createElement('div');
  el.className = 'history-entry';
  el.onclick = () => injectPrompt(request);
  el.innerHTML = `
    <span class="history-type-tag">${esc(type)}</span>
    <span class="history-text">${esc(request.length > 50 ? request.slice(0,50)+'...' : request)}</span>`;
  list.insertBefore(el, list.firstChild);

  while (list.children.length > 15) list.removeChild(list.lastChild);
}

// ============ STATS ============
function updateStats() {
  const { total, ok, times, byType } = S.stats;
  document.getElementById('s-total').textContent = total;
  document.getElementById('s-session').textContent = total;
  document.getElementById('s-success').textContent = total ? Math.round((ok/total)*100)+'%' : '‚Äì';
  document.getElementById('s-avgtime').textContent = times.length ? (times.reduce((a,b)=>a+b,0)/times.length).toFixed(1) : '‚Äì';
  document.getElementById('task-count').textContent = total + ' tasks';

  const bd = document.getElementById('breakdown-list');
  bd.innerHTML = '';
  const entries = Object.entries(byType);
  if (!entries.length) { bd.innerHTML = '<div class="no-stats">Run tasks to see breakdown...</div>'; return; }
  const max = Math.max(...entries.map(([,v])=>v));
  entries.sort((a,b)=>b[1]-a[1]).forEach(([t,c]) => {
    const row = document.createElement('div');
    row.className = 'breakdown-item';
    row.innerHTML = `
      <span class="bd-label">${esc(t)}</span>
      <div class="bd-bar"><div class="bd-fill" style="width:${(c/max*100).toFixed(0)}%"></div></div>
      <span class="bd-count">${c}</span>`;
    bd.appendChild(row);
  });
}

// ============ GEMINI API (via Flask) ============
async function callGemini(prompt) {
  const response = await fetch('/api/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prompt })
  });
  const data = await response.json();
  if (data.error) throw new Error(data.error);
  return data.text;
}

// ============ TASK EXECUTORS ============
const PROMPTS = {
  schedule: p => `You are a scheduling assistant. Based on this information, create a structured schedule entry. Respond ONLY with JSON (no markdown, no backticks):
{"title":"event title","datetime":"parsed date and time","duration":"estimated duration","notes":"any additional details"}

Info: ${JSON.stringify(p)}`,

  dataAnalysis: p => `You are a data analyst. Analyze the following and provide insights in JSON format (no markdown, no backticks):
{"insights":["insight 1","insight 2"],"metrics":{"metric":"value"},"recommendations":["recommendation 1"]}

Data: ${JSON.stringify(p)}`,

  fileOrganization: p => `You are a file organization expert. Suggest an organization structure in JSON (no markdown, no backticks):
{"categories":["category1","category2"],"structure":{"category":["items"]},"rules":["rule 1"]}

Request: ${JSON.stringify(p)}`,

  search: p => `You are a search assistant. Provide relevant results in JSON (no markdown, no backticks):
{"results":[{"title":"result 1","relevance":"95%","summary":"brief summary"},{"title":"result 2","relevance":"87%","summary":"brief summary"}],"totalFound":5}

Query: ${JSON.stringify(p)}`,

  textProcessing: p => `You are a text processing AI. Process the following and return results in JSON (no markdown, no backticks):
{"processed":"the processed text","wordCount":0,"summary":"brief summary of what was done"}

Request: ${JSON.stringify(p)}`,

  calculation: p => `You are a calculation assistant. Solve this and return results in JSON (no markdown, no backticks):
{"result":"the calculated result","steps":["step 1","step 2"],"explanation":"brief explanation"}

Problem: ${JSON.stringify(p)}`
};

const TYPE_MAP = { dataAnalysis:'analysis', fileOrganization:'organization' };
const SUMMARIES = {
  schedule:        d => `‚úÖ Scheduled: ${d.title||'event'} at ${d.datetime||'TBD'}`,
  dataAnalysis:    d => `üìä Analysis complete: ${(d.insights||[]).length} insights found`,
  fileOrganization:d => `üìÅ Organized into ${(d.categories||[]).length} categories`,
  search:          d => `üîç Found ${d.totalFound||(d.results||[]).length} results`,
  textProcessing:  d => `üìù Text processed: ${d.wordCount||0} words`,
  calculation:     d => `üî¢ Result: ${d.result}`
};

async function executeTask(analysis, userRequest) {
  const type = analysis.taskType;
  const params = analysis.parameters;

  if (PROMPTS[type]) {
    const raw = await callGemini(PROMPTS[type](params));
    const clean = raw.replace(/```json|```/g,'').trim();
    try {
      const data = JSON.parse(clean);
      const rtype = TYPE_MAP[type] || type;
      return { type: rtype, data, summary: (SUMMARIES[type]||(() => '‚úÖ Done'))(data) };
    } catch {
      return { type: TYPE_MAP[type]||type, data: { response: raw }, summary: '‚úÖ Task completed' };
    }
  }

  // Generic
  const raw = await callGemini(`You are a helpful automation assistant. Process this request and provide a helpful response.\n\nRequest: ${userRequest}`);
  return { type: 'generic', data: { response: raw }, summary: '‚úÖ Task completed' };
}

// ============ MAIN SEND HANDLER ============
async function handleSend() {
  const inp = document.getElementById('msg-input');
  const text = inp.value.trim();
  if (!text || S.busy) return;

  S.busy = true;
  document.getElementById('send-btn').disabled = true;
  inp.value = '';
  inp.style.height = 'auto';
  document.getElementById('char-count').textContent = '0 chars';

  addUserBubble(text);
  addTyping();
  const t0 = Date.now();

  addLog('Received request', 'info');

  try {
    // Step 1: Analyze
    setTypingStatus('Analyzing task type...');
    addLog('Analyzing task...', 'info');

    const analysisPrompt = `You are a task analysis AI. Analyze this request and respond ONLY with a JSON object (no markdown, no backticks):
{
  "taskType": "one of: schedule, dataAnalysis, fileOrganization, search, textProcessing, calculation, other",
  "parameters": {"key": "value pairs of extracted info"},
  "steps": ["step 1", "step 2", "step 3"],
  "priority": "high/medium/low"
}

Request: ${text}`;

    const analysisRaw = await callGemini(analysisPrompt);
    let analysis;
    try {
      analysis = JSON.parse(analysisRaw.replace(/```json|```/g,'').trim());
      addLog(`Task type: ${analysis.taskType}`, 'success');
    } catch {
      analysis = { taskType: 'other', parameters: { request: text }, steps: ['Process request', 'Generate response'], priority: 'medium' };
      addLog('Fallback analysis used', 'warning');
    }

    // Step 2: Execute
    setTypingStatus(`Running ${analysis.taskType} handler...`);
    addLog(`Executing ${analysis.taskType}...`, 'info');

    const result = await executeTask(analysis, text);
    const elapsed = ((Date.now() - t0) / 1000).toFixed(1);

    // Update state
    S.stats.total++;
    S.stats.ok++;
    S.stats.times.push(parseFloat(elapsed));
    S.stats.byType[analysis.taskType] = (S.stats.byType[analysis.taskType]||0) + 1;
    S.history.push({ timestamp: new Date().toISOString(), request: text, type: result.type });

    addLog(`Completed in ${elapsed}s`, 'success');
    renderHistoryEntry(text, analysis.taskType);
    persistHistory();
    updateStats();

    removeTyping();
    addAgentBubble(result, analysis);

  } catch (err) {
    addLog(`Error: ${err.message}`, 'error');
    removeTyping();
    addErrorBubble(err.message);
    S.stats.total++;
  }

  S.busy = false;
  document.getElementById('send-btn').disabled = false;
  inp.focus();
}
</script>
</body>
</html>
